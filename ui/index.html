<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ðŸ’€ðŸ“¸âœ¨</title>
</head>
<body>
<h2>hi im skelly cam wow </h2>
<script>
    const ws = new WebSocket('ws://localhost:8003/ws/connect');

    ws.onopen = function () {
        console.log('Connected to the server.');
    };

    ws.onmessage = function (event) {
        if (typeof event.data === 'string') {
            console.log('Received string message:', event.data);
        } else if (event.data instanceof Blob) {
            const reader = new FileReader();
            reader.onload = function () {
                const arrayBuffer = this.result;
                const uint8Array = new Uint8Array(arrayBuffer);
                const payload = msgpack.decode(uint8Array);
                const jpegImagesByCamera = payload.jpeg_images_by_camera;

                Object.keys(jpegImagesByCamera).forEach(cameraId => {
                        const jpegImage = jpegImagesByCamera[cameraId];
                        if (jpegImage) {
                            const image = new Image()
                            image.onload = () => {
                                const canvas = document.getElementById(`camera${cameraId}`) || updateCanvasElements(jpegImagesByCamera)
                                canvas.width = image.width
                                canvas.height = image.height
                                const context = canvas.getContext('2d')
                                context.drawImage(image, 0, 0, canvas.width, canvas.height)
                                URL.revokeObjectURL(image.src)
                            }
                            const blob = new Blob([jpegImage], {type: 'image/jpeg'});

                            const url = URL.createObjectURL(blob)
                            image.src = url
                        }
                    }
                );
            }
            reader.readAsArrayBuffer(event.data);
        } else {
            console.error('Received message of unknown type:', event.data);
        }
    };

    function updateCanvasElements(jpegImagesByCamera) {
        const cameras = Object.keys(jpegImagesByCamera);
        const body = document.body;

        cameras.forEach(cameraId => {
            if (!document.getElementById(`camera${cameraId}`)) {
                const canvas = document.createElement('canvas');
                canvas.id = `camera${cameraId}`;

                body.appendChild(canvas);
            }
        });
    }

    ws.onerror = function (error) {
        console.error('WebSocket error:', error);
    };

    ws.onclose = function () {
        console.log('Disconnected from the server.');
    };


</script>
</body>

<style>
    canvas {
        border: 3px solid red; /* Change 'red' to any color you want */
    }
</style>

</html>
